<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cadastro Servidor</title>
  <link rel="stylesheet" href="css/cadastroserver.css">
  <script src="js/sessao.js"></script>
</head>

<body>

  <header class="escuro">
    <section class="container">

      <nav class="menu">
        <input type="checkbox" name="chk_hamburguer" id="chk_hamburguer" class="check_hamburguer">

        <section class="hamburguer">
          <span></span>
          <span></span>
          <span></span>
        </section>
        <ul>
          <div class="title_hamb">
            <img class="img_hamb" src="assets/LogoVitalView.png" alt="">
            <h2 class="hamb_nome">VitalView</h2>
          </div>
          <div class="menu_topo">
                        <h3 class="title_menu">Menu</h3>
                        <li>
                            <a href="dashboard.html"> Dashboard </a>
                        </li>
                        <li>
                            <a href="cadastroserver.html"> Cadastro Servidores </a>
                        </li>
                        <li>
                            <a href="dashboardSuporteMacro.html"> Dashboard Suporte </a>
                        </li>
                    </div>

          <div class="menu_baixo">
            <h3 class="title_menu">Outras Opções</h3>
            <li>
              <a target="_blank"> Central de Serviço </a>
            </li>
            <li>
              <a href="cadastro.html"> Cadastro </a>
            </li>
            <li>
              <a onclick="limparSessao()"> Sair </a>
            </li>
          </div>
        </ul>
      </nav>

      <section class="secao_logo">
        <h1 class="titulo_header">Cadastro de Servidores</h1>
      </section>

      <section class="secao_logo">
        <a href="dashboard.html">
          <img src="assets/LogoVitalView.png" alt="Logo VitalView" class="logo">
        </a>
        <div class="linha"></div>
      </section>

    </section>
  </header>

  <form class="form-servidor">
    <h2>Informações do Servidor:</h2>
    <br>

    <!-- <div class="form-control">
        <label for="so">Sistema Operacional *</label>
        <select id="so" name="so" required>
          <option value="" disabled selected>Selecione</option>
          <option>Windows Server</option>
          <option>Ubuntu Server</option>
          <option>Debian</option>
          <option>Red Hat</option>
        </select>
      </div> -->

    <div class="form-control">
      <label for="hostname">Hostname *</label>
      <input type="text" id="ipt_hostname" name="hostname" placeholder="Ex.: srv-local-01" required>
    </div>

    <div class="form-control">
      <label for="ip">Endereço IP *</label>
      <input type="text" id="ipt_ip" name="ip" placeholder="Ex.: 192.168.0.10" required>
    </div>

    <!-- <div class="form-control">
        <label for="memoria">Memória RAM (GB) *</label>
        <input type="number" id="memoria" name="memoria" min="1" placeholder="Ex.: 16" required>
      </div> -->

      <div class="form-control">
      <label for="disco">RAM (GB)*</label>
      <input type="number" id="ipt_ram" name="ram" min="1" placeholder="Ex.: 16" required>
    </div>

    <div class="form-control">
      <label for="disco">Disco (GB) *</label>
      <input type="number" id="ipt_disco" name="disco" min="1" placeholder="Ex.: 512" required>
    </div>

    <h2>Informações de parametrização:</h2>
    <br>

    <!-- CPU -->
    <div class="form-control">
      <label for="ipt_porcentagem_cpu">Porcentagem para gerar alerta na CPU *</label>
      <button type="button" class="infoBtn" data-target="infoModalCpu">ℹ️</button>
      <input type="number" id="ipt_porcentagem_cpu" name="porcentagem_cpu" min="1" placeholder="Ex.: 70">
    </div>

    <!-- RAM -->
    <div class="form-control">
      <label for="ipt_porcentagem_ram">Porcentagem para gerar alerta na RAM *</label>
      <button type="button" class="infoBtn" data-target="infoModalRam">ℹ️</button>
      <input type="number" id="ipt_porcentagem_ram" name="porcentagem_ram" min="1" placeholder="Ex.: 80">
    </div>

    <!-- Disco -->
    <div class="form-control">
      <label for="ipt_porcentagem_disco">Porcentagem para gerar alerta no disco *</label>
      <button type="button" class="infoBtn" data-target="infoModalDisco">ℹ️</button>
      <input type="number" id="ipt_porcentagem_disco" name="porcentagem_disco" min="1" placeholder="Ex.: 90">
    </div>

    <!-- MODAIS -->
    <div id="infoModalCpu" class="modal">
      <div class="modal-content">
        <h3>CPU</h3>
        <p style="text-align: justify;">Define a porcentagem limite para atingir um alerta de <b>CPU</b>. Por exemplo, se você definir "50%", o sistema enviará um alerta
          quando a CPU atingir 50% <br><br>
          Por padrão, se você não digitar nada, será definido uma porcentagem de <b>80%</b>, seguindo nossa recomendação.
        </p>
        <button class="closeBtn">Fechar</button>
      </div>
    </div>

    <div id="infoModalRam" class="modal">
      <div class="modal-content">
        <h3>RAM</h3>
        <p style="text-align: justify;">Define a porcentagem limite para atingir um alerta de <b>RAM</b>. Por exemplo, se você definir "50%", o sistema enviará um alerta
          quando a RAM atingir 50% <br><br>
          Por padrão, se você não digitar nada, será definido uma porcentagem de <b>85%</b>, seguindo nossa recomendação.
        </p>
        <button class="closeBtn">Fechar</button>
      </div>
    </div>

    <div id="infoModalDisco" class="modal">
      <div class="modal-content">
        <h3>Disco</h3>
        <p style="text-align: justify;">Define a porcentagem limite para atingir um alerta de <b>disco</b>. Por exemplo, se você definir "50%", o sistema enviará um alerta
          quando a CPU atingir 50% <br><br>
          Por padrão, se você não digitar nada, será definido uma porcentagem de <b>90%</b>, seguindo nossa recomendação.
        </p>
        <button class="closeBtn">Fechar</button>
      </div>
    </div>

    <div class="form-actions">
        <button type="reset" class="btn cancel">Cancelar</button>
        <button class="btn save" type="button" onclick="salvar(event)">Salvar</button>
      </div>
  </form>

</body>

</html>
<script>
  const infoBtns = document.querySelectorAll('.infoBtn');
  const modals = document.querySelectorAll('.modal');
  const closeBtns = document.querySelectorAll('.closeBtn');

  infoBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      const target = btn.dataset.target;
      document.getElementById(target).style.display = 'flex';
    });
  });

  closeBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      btn.closest('.modal').style.display = 'none';
    });
  });

  modals.forEach(modal => {
    modal.addEventListener('click', (e) => {
      if (e.target === modal) modal.style.display = 'none';
    });
  });

  function salvar(){
    let hostnameVar = ipt_hostname.value;
    let ipVar = ipt_ip.value;
    let ramVar = ipt_ram.value;
    let discoVar = ipt_disco.value;

    let porcentagem_cpuVar = ipt_porcentagem_cpu.value;
    let porcentagem_ramVar = ipt_porcentagem_ram.value;
    let porcentagem_discoVar = ipt_porcentagem_disco.value;

    let fkHospitalVar = sessionStorage.FK_HOSPITAL;

    if(porcentagem_cpuVar == ""){
        porcentagem_cpuVar = 80;
    }

    if(porcentagem_ramVar == ""){
        porcentagem_ramVar = 85;
    }

    if(porcentagem_discoVar == ""){
        porcentagem_discoVar = 90;
    }
    
    fetch("/servidores/cadastrar-servidor", {
        method: "POST",
        headers:{
            "Content-Type": "application/json",
        },
        body: JSON.stringify({

        hostnameServer: hostnameVar,
        ipServer: ipVar,

        ramServer: ramVar,
        discoServer: discoVar,
        
        porcentagemCpuServer: porcentagem_cpuVar,
        porcentagemRamServer: porcentagem_ramVar,
        porcentagemDiscoServer: porcentagem_discoVar,

        fkHospitalServer: fkHospitalVar

      }),
    })
        .then((resposta) => {
            if(resposta.ok){
                alert("Servidor cadastrado com sucesso!")
            }else {
                    alert("Erro ao cadastrar. Verifique os dados e tente novamente.");
                }
        })
        .catch((erro) => {
                console.error("Erro na requisição: ", erro);
                alert("Erro na conexão com o servidor.");
            });

            podeSalvar = false;

}

</script>
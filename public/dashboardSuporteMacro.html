<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Suporte</title>
    <link rel="stylesheet" href="css/macro.css">
    <script src="js/sessao.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
</head>

<body>

    <header class="escuro">
        <section class="container">

            <nav class="menu">
                <input type="checkbox" name="chk_hamburguer" id="chk_hamburguer" class="check_hamburguer">

                <section class="hamburguer">
                    <span></span>
                    <span></span>
                    <span></span>
                </section>

                <ul>
                    <div class="title_hamb">
                        <img class="img_hamb" src="assets/LogoVitalView.png" alt="">
                        <h2 class="hamb_nome">VitalView</h2>
                    </div>
                    <div class="menu_topo">
                        <h3 class="title_menu">Dashboards</h3>
                        <li>
                            <a href="dashboardAnalista.html"> Dash Analista </a>
                        </li>
                        <li>
                            <a href="dashboardSuporteMacro.html"> Dash Suporte Macro</a>
                        </li>
                        <li>
                            <a href="dashboardSuporteMicro.html"> Dash Suporte Micro</a>
                        </li>
                        
                    </div>

                    <div class="menu_baixo">
                        <h3 class="title_menu">Outras Opções</h3>
                        <li>
                            <a href="cadastro.html"> Cadastro Funcionário </a>
                        </li>
                        <li>
                            <a href="cadastroserver.html"> Cadastro Servidores </a>
                        </li>
                        <li>
                            <a target="_blank"> Central de Serviço </a>
                        </li>
                        <li>
                            <a onclick="limparSessao()"> Sair </a>
                        </li>
                    </div>
                </ul>
            </nav>

            <section class="secao_logo">
                <h1 class="titulo_header">Dashboard Suporte (Macro)</h1>
            </section>

            <section class="secao_logo">
                <a href="dashboardAnalista.html">
                    <img src="assets/LogoVitalView.png" alt="Logo VitalView" class="logo">
                </a>
                <div class="linha"></div>
            </section>

        </section>
    </header>

    <div class="wrap">

        <!-- KPIs -->
        <section class="kpis">
            <article class="kpi">
                <h4>Servidores em Risco</h4>
                <div class="value mono">12<span>/18</span></div>
            </article>

            <article class="kpi">
                <h4>Servidor com mais alertas</h4>
                <div class="value">SERV-PACS</div>
                <ul class="list">
                    <p>RAM – 27 alertas</p>
                    <p>CPU – 20 alertas</p>
                    <p>DISCO – 5 alertas</p>
                </ul>
            </article>

            <article class="kpi">
                <h4>Alertas (últimas 24h)</h4>
                <div class="value mono">16</div>
            </article>

            <article class="kpi">
                <h4>Tendência de alertas (próx. 30 min)</h4>
                <div class="value mono">23%</div>
            </article>
        </section>

        <section class="grid">
            <!-- COLUNA ESQUERDA -->
            <div class="left-col">
                <!-- Pizza: Alertas x Normais -->
                <article class="cardPizza">
                    <h3>Servidores em Alerta × Normais</h3>

                    <div class="chart-box">
                        <canvas id="pizzaAlertas"></canvas>
                    </div>

                    <div class="legend-inline">
                        <div class="item"><span class="swatch" id="swatch-alerta"></span> Alerta (34%)</div>
                        <div class="item"><span class="swatch" id="swatch-normal"></span> Normal (66%)</div>
                    </div>
                </article>


                <!-- Servidores (mini barras) -->
                <article class="card">
                    <h3>Servidores</h3>

                    <div class="mini">
                        <div class="servers">
                            <!-- Servidor 1 -->
                            <div class="server">
                                <div class="name">Servidor 1</div>
                                <canvas id="mini1" height="48"></canvas>
                                <div class="status">Crítico</div>
                            </div>
                            <!-- Servidor 2 -->
                            <div class="server">
                                <div class="name">Servidor 2</div>
                                <canvas id="mini2" height="48"></canvas>
                                <div class="status">Crítico</div>
                            </div>
                            <!-- Servidor 3 -->
                            <div class="server">
                                <div class="name">Servidor 3</div>
                                <canvas id="mini3" height="48"></canvas>
                                <div class="status" style="color:#f59e0b">Atenção</div>
                            </div>
                        </div>
                    </div>

                    <div style="margin-top:10px;color:var(--muted);font-size:13px">
                        <span class="pill">Servidores Cadastrados: <b style="color:var(--ink)">18</b></span>
                    </div>
                </article>
            </div>

            <!-- COLUNA DIREITA: Servidores em risco -->
            <aside class="risk-list">
                <div class="card">
                    <h3>Servidores em risco</h3>
                </div>

                <!-- Risco 1 -->
                <article class="risk">
                    <h4>Servidor-01</h4>
                    <div class="chips">
                        <span class="pill" style="background:#fee2e2;color:#b91c1c">6 alertas</span>
                        <span class="pill">Disco</span>
                    </div>
                    <div class="divider"></div>
                    <div class="kv">
                        <div>CPU: <b>99%</b></div>
                        <div>Limite: <b>99%</b></div>
                        <div>RAM: <b>58%</b></div>
                        <div>Limite: <b>58%</b></div>
                        <div>Disco: <b>68%</b></div>
                        <div>Limite: <b>68%</b></div>
                    </div>
                    <div class="sub">Tempo em alerta: 00:16:15</div>
                </article>

                <!-- Risco 2 -->
                <article class="risk">
                    <h4>Servidor-02</h4>
                    <div class="chips">
                        <span class="pill" style="background:#fee2e2;color:#b91c1c">4 alertas</span>
                        <span class="pill">RAM</span>
                    </div>
                    <div class="divider"></div>
                    <div class="kv">
                        <div>CPU: <b>99%</b></div>
                        <div>Limite: <b>99%</b></div>
                        <div>RAM: <b>58%</b></div>
                        <div>Limite: <b>58%</b></div>
                        <div>Disco: <b>68%</b></div>
                        <div>Limite: <b>68%</b></div>
                    </div>
                    <div class="sub">Tempo em alerta: 00:09:01</div>
                </article>

                <!-- Risco 3 -->
                <article class="risk">
                    <h4>Servidor-06</h4>
                    <div class="chips">
                        <span class="pill" style="background:#fee2e2;color:#b91c1c">1 alerta</span>
                        <span class="pill">Disco</span>
                    </div>
                    <div class="divider"></div>
                    <div class="kv">
                        <div>CPU: <b>99%</b></div>
                        <div>Limite: <b>99%</b></div>
                        <div>RAM: <b>58%</b></div>
                        <div>Limite: <b>58%</b></div>
                        <div>Disco: <b>68%</b></div>
                        <div>Limite: <b>68%</b></div>
                    </div>
                    <div class="sub">Tempo em alerta: 00:16:15</div>
                </article>
            </aside>
        </section>
    </div>

    <script>
        // =========================
        // DADOS MOCADOS / ESTÁTICOS
        // =========================
        const PIZZA = {
            labels: ['Alerta', 'Normal'],
            data: [34, 66]
        };
        const SERVIDORES_MINI = [
            // cpu, ram, disco
            { id: 'mini1', valores: [70, 40, 70] },   // Servidor 1
            { id: 'mini2', valores: [12, 34, 92] },   // Servidor 2
            { id: 'mini3', valores: [55, 61, 48] },   // Servidor 3
        ];

        // Paleta consistente com a UI
        const COLORS = {
            alerta: '#ef4444',
            normal: '#10b981',
            cpu: '#ef4444',
            ram: '#60a5fa',
            disco: '#f43f5e'
        };

        // =========================
        // PIZZA: Alertas x Normais
        // =========================
        const pizzaCtx = document.getElementById('pizzaAlertas');
        const pizza = new Chart(pizzaCtx, {
            type: 'doughnut',
            data: {
                labels: ['Alerta', 'Normal'],
                datasets: [{
                    data: [34, 66],
                    backgroundColor: ['#ef4444', '#10b981'],
                    borderWidth: 0,
                    hoverOffset: 4,
                    cutout: '62%'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,  
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: (ctx) => `${ctx.label}: ${ctx.raw}%`
                        }
                    }
                }
            }
        });

        // Atualiza as amostras da legenda manual
        document.getElementById('swatch-alerta').style.background = COLORS.alerta;
        document.getElementById('swatch-normal').style.background = COLORS.normal;

        // ==========================================
        // MINI BARRAS HORIZONTAIS por servidor (CPU/RAM/Disco)
        // ==========================================
        SERVIDORES_MINI.forEach((srv) => {
            const ctx = document.getElementById(srv.id);
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: [''], // uma linha
                    datasets: [
                        { label: 'CPU', data: [srv.valores[0]], backgroundColor: COLORS.cpu, borderRadius: 8, barPercentage: 0.6 },
                        { label: 'RAM', data: [srv.valores[1]], backgroundColor: COLORS.ram, borderRadius: 8, barPercentage: 0.6 },
                        { label: 'Disco', data: [srv.valores[2]], backgroundColor: COLORS.disco, borderRadius: 8, barPercentage: 0.6 },
                    ]
                },
                options: {
                    indexAxis: 'y',
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: { boxWidth: 10, usePointStyle: true, pointStyle: 'rectRounded' }
                        },
                        tooltip: {
                            callbacks: {
                                label: (ctx) => `${ctx.dataset.label}: ${ctx.raw}%`
                            }
                        }
                    },
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            min: 0, max: 100, grid: { display: false }, ticks: { callback: v => v + '%' }
                        },
                        y: { grid: { display: false } }
                    }
                }
            });
        });
    </script>
</body>

</html>
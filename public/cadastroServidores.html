<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cadastro Servidor</title>
  <link rel="stylesheet" href="css/cadastroServidores.css">
  <script src="js/sessao.js"></script>
</head>

<body>
  <header class="escuro">
    <section class="container">

      <nav class="menu">
        <input type="checkbox" name="chk_hamburguer" id="chk_hamburguer" class="check_hamburguer">

        <section class="hamburguer">
          <span class="menu_lateral">
            <div class="icones_topo">
              <img class="img_hamb" src="assets/LogoVitalView.png" alt="">
              <img src="./assets/dashboard-icons/layout.svg" alt="">
              <img src="./assets/dashboard-icons/activity.svg" alt="">
              <img src="./assets/dashboard-icons/calendar.svg" alt="">
              <img src="./assets/dashboard-icons/bar-chart.svg" alt="">
            </div>

            <div class="icones_baixo">
              <img src="./assets/dashboard-icons/settings.svg" alt="">
              <img src="./assets/dashboard-icons/users.svg" alt="">
              <img src="./assets/dashboard-icons/help-circle.svg" alt="">
              <img src="./assets/dashboard-icons/log-out.svg" alt="">
            </div>
          </span>
        </section>
        <ul>
          <div class="title_hamb">
            <img class="img_hamb" src="assets/LogoVitalView.png" alt="">
            <h2 class="hamb_nome">VitalView</h2>
          </div>
          <div class="menu_topo">
            <h3 class="title_menu">Dashboards</h3>
            <li><a href="dashboardAnalista.html" data-role="Analista,Administrador">Dash Analista</a></li>
            <li><a href="dashboardSuporteMacro.html" data-role="Técnico,Administrador">Dash Suporte Macro</a></li>
            <li><a href="dashboardSuporteMicro.html" data-role="Técnico,Administrador">Dash Suporte Micro</a></li>
          </div>

          <div class="menu_baixo">
            <h3 class="title_menu">Outras Opções</h3>
            <li><a href="historicoAlertas.html" data-role="Analista,Técnico,Administrador">Histórico de Alertas</a>
            </li>
            <li><a href="cadastroFuncionarios.html" data-role="Administrador">Cadastro Funcionário</a></li>
            <li><a href="cadastroServidores.html" data-role="Técnico,Administrador">Cadastro Servidores</a></li>
            <li><a href="https://vitalviewsptech.atlassian.net/servicedesk/customer/portal/1" target="_blank"
                data-role="Analista,Técnico,Administrador">Central de Serviço</a></li>
            <li><a onclick="limparSessao()" data-role="Analista,Técnico,Administrador">Sair</a></li>
          </div>
        </ul>
      </nav>

      <section class="secao_logo">
        <h1 class="titulo_header">Cadastro de Servidores</h1>
      </section>

      <section class="secao_logo">
        <a href="dashboard.html">
          <img src="assets/LogoVitalView.png" alt="Logo VitalView" class="logo">
        </a>
        <div class="linha"></div>
      </section>

    </section>
  </header>

  <!-- CONTAINER PRINCIPAL SIMILAR AO CADASTRO ANTERIOR -->
  <div class="container-servidor">
    <div class="card">
      <div class="formulario">
        <h2>Informações do Servidor</h2>
        <div class="campo">
          <span>Hostname:</span>
          <input type="text" id="ipt_hostname" placeholder="Ex.: srv-local-01" required>
        </div>
        <div class="campo">
          <span>Endereço IP:</span>
          <input type="text" id="ipt_ip" placeholder="Ex.: 192.168.0.10" required>
        </div>
        <div class="campo">
          <span>Localização</span>
          <input type="text" id="ipt_localizacao" placeholder="Ex.: Sala os servidores" required>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="formulario">
        <h2>Informações de Parametrização</h2>

        <!-- CPU -->
        <div class="campo">
          <span>Alerta CPU (%):</span>
          <div class="input-with-info">
            <input type="number" id="ipt_porcentagem_cpu" min="1" placeholder="Ex.: 70">
            <button type="button" class="infoBtn" data-target="infoModalCpu">&#9432</button>
          </div>
        </div>

        <!-- RAM -->
        <div class="campo">
          <span>Alerta RAM (%):</span>
          <div class="input-with-info">
            <input type="number" id="ipt_porcentagem_ram" min="1" placeholder="Ex.: 80">
            <button type="button" class="infoBtn" data-target="infoModalRam">&#9432</button>
          </div>
        </div>

        <!-- Disco -->
        <div class="campo">
          <span>Alerta Disco (%):</span>
          <div class="input-with-info">
            <input type="number" id="ipt_porcentagem_disco" min="1" placeholder="Ex.: 90">
            <button type="button" class="infoBtn" data-target="infoModalDisco">&#9432</button>
          </div>
        </div>

        <div class="form-actions">
          <button type="reset" class="btn cancel" onclick="limparFormulario()">Limpar</button>
          <button type="button" class="btn save" onclick="salvar()">Cadastrar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAIS -->
  <div id="infoModalCpu" class="modal">
    <div class="modal-content">
      <h3>CPU</h3>
      <p style="text-align: justify;">Define a porcentagem limite para atingir um alerta de <b>CPU</b>. Por exemplo,
        se você definir "50%", o sistema enviará um alerta
        quando a CPU atingir 50% <br><br>
        Por padrão, se você não digitar nada, será definido uma porcentagem de <b>80%</b>, seguindo nossa
        recomendação.
      </p>
      <button type="button" class="closeBtn">Fechar</button>
    </div>
  </div>

  <div id="infoModalRam" class="modal">
    <div class="modal-content">
      <h3>RAM</h3>
      <p style="text-align: justify;">Define a porcentagem limite para atingir um alerta de <b>RAM</b>. Por exemplo,
        se você definir "50%", o sistema enviará um alerta
        quando a RAM atingir 50% <br><br>
        Por padrão, se você não digitar nada, será definido uma porcentagem de <b>85%</b>, seguindo nossa
        recomendação.
      </p>
      <button type="button" class="closeBtn">Fechar</button>
    </div>
  </div>

  <div id="infoModalDisco" class="modal">
    <div class="modal-content">
      <h3>Disco</h3>
      <p style="text-align: justify;">Define a porcentagem limite para atingir um alerta de <b>disco</b>. Por exemplo,
        se você definir "50%", o sistema enviará um alerta
        quando a CPU atingir 50% <br><br>
        Por padrão, se você não digitar nada, será definido uma porcentagem de <b>90%</b>, seguindo nossa
        recomendação.
      </p>
      <button type="button" class="closeBtn">Fechar</button>
    </div>
  </div>

  <div id="div_resposta"></div>

  <script src="js/permissoes.js"></script>

  <script>

    protegerPagina(['Técnico', 'Administrador']);
    aplicarCargoNaUI();

    // Função para limpar formulário (similar ao primeiro cadastro)
    function limparFormulario() {
      const campos = document.querySelectorAll('.container-servidor input');
      campos.forEach(campo => {
        campo.value = '';
      });
    }

    const infoBtns = document.querySelectorAll('.infoBtn');
    const modals = document.querySelectorAll('.modal');
    const closeBtns = document.querySelectorAll('.closeBtn');

    infoBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const target = btn.dataset.target;
        document.getElementById(target).style.display = 'flex';
      });
    });

    closeBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        btn.closest('.modal').style.display = 'none';
      });
    });

    modals.forEach(modal => {
      modal.addEventListener('click', (e) => {
        if (e.target === modal) modal.style.display = 'none';
      });
    });

    function salvar() {
      let hostnameVar = ipt_hostname.value;
      let ipVar = ipt_ip.value;
      let localizacaoVar = ipt_localizacao.value;

      let porcentagem_cpuVar = ipt_porcentagem_cpu.value;
      let porcentagem_ramVar = ipt_porcentagem_ram.value;
      let porcentagem_discoVar = ipt_porcentagem_disco.value;

      let fkHospitalVar = sessionStorage.FK_HOSPITAL;

      if (porcentagem_cpuVar == "") {
        porcentagem_cpuVar = 80;
      }

      if (porcentagem_ramVar == "") {
        porcentagem_ramVar = 85;
      }

      if (porcentagem_discoVar == "") {
        porcentagem_discoVar = 90;
      }

      fetch("/servidores/cadastrar-servidor", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({

          hostnameServer: hostnameVar,
          ipServer: ipVar,

          localizacaoServer: localizacaoVar,

          porcentagemCpuServer: porcentagem_cpuVar,
          porcentagemRamServer: porcentagem_ramVar,
          porcentagemDiscoServer: porcentagem_discoVar,

          fkHospitalServer: fkHospitalVar

        }),
      })
        .then((resposta) => {
          if (resposta.ok) {
            alert("Servidor cadastrado com sucesso!")
          } else {
            alert("Erro ao cadastrar. Verifique os dados e tente novamente.");
          }
        })
        .catch((erro) => {
          console.error("Erro na requisição: ", erro);
          alert("Erro na conexão com o servidor.");
        });

      podeSalvar = false;

    }

  </script>

</body>

</html>
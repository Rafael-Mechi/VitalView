<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Rede</title>
    <link rel="stylesheet" href="css/dashRede.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <script src="js/sessao.js"></script>
</head>

<body>

    <nav class="menu">
        <input type="checkbox" name="chk_hamburguer" id="chk_hamburguer" class="check_hamburguer">

        <section class="hamburguer">
            <span class="menu_lateral">
                <div class="icones_topo">
                    <img class="img_hamb" src="assets/LogoVitalView.png">
                    <img src="./assets/dashboard-icons/activity.svg" data-role="Analista,Administrador">
                    <img src="./assets/dashboard-icons/bar-chart.svg" data-role="Técnico,Administrador">
                    <img src="./assets/dashboard-icons/layout.svg" data-role="Técnico,Administrador">
                </div>

                <div class="icones_baixo">
                    <img src="./assets/dashboard-icons/gerenciar-usuarios.png" data-role="Administrador"
                        style="width: 28px; height: 28px;">
                    <img src="./assets/dashboard-icons/calendar.svg" data-role="Analista,Técnico,Administrador">
                    <img src="./assets/dashboard-icons/users.svg" data-role="Administrador">
                    <img src="./assets/dashboard-icons/hard-drive.svg" data-role="Técnico,Administrador">
                    <img src="./assets/dashboard-icons/help-circle.svg" data-role="Analista,Técnico,Administrador">
                    <img src="./assets/dashboard-icons/log-out.svg" data-role="Analista,Técnico,Administrador">
                </div>
            </span>
        </section>

        <ul>
            <div class="title_hamb">
                <img class="img_hamb" src="assets/LogoVitalView.png" alt="">
                <h2 class="hamb_nome">VitalView</h2>
            </div>
            <div class="menu_topo">
                <h3 class="title_menu">Dashboards</h3>
                <li style="display: flex; align-items: center;" data-role="Analista,Administrador,Técnico">
                    <img src="./assets/dashboard-icons/home.svg" style="width: 20px; margin-right: 4px;"><a
                        href="bemVindo.html">Home</a>
                </li>
                <li style="display: flex; align-items: center;" data-role="Analista,Administrador" class="pagina-ativa">
                    <img src="./assets/dashboard-icons/activity.svg" style="width: 20px; margin-right: 4px;"><a
                        href="dashboardAnalista.html">Dash Analista</a>
                </li>
                <li style="display: flex; align-items: center;" data-role="Técnico,Administrador"><img
                        src="./assets/dashboard-icons/bar-chart.svg" style="width: 20px; margin-right: 4px;"><a
                        href="dashboardSuporteMacro.html">Dash Suporte Macro</a></li>
                <li style="display: flex; align-items: center;" data-role="Técnico,Administrador"><img
                        src="./assets/dashboard-icons/layout.svg" style="width: 20px; margin-right: 4px;"><a
                        href="dashboardSuporteMicro.html">Dash Suporte Micro</a></li>
                <li style="display: flex; align-items: center;" data-role="Técnico,Administrador">
                    <img src="./assets/dashboard-icons/wifi (1).svg" style="width: 20px; margin-right: 4px;"><a
                        href="dashRede.html">Dashboard Rede</a>
                </li>
            </div>

            <div class="menu_baixo">
                <h3 class="title_menu">Outras Opções</h3>
                <li style="display: flex; align-items: center;" data-role="Administrador"><img
                        src="./assets/dashboard-icons/gerenciar-usuarios.png" style="width: 20px; margin-right: 4px;"><a
                        href="dashControleSistema.html">Gerenciar usuários</a></li>
                <li style="display: flex; align-items: center;" data-role="Analista,Técnico,Administrador"><img
                        src="./assets/dashboard-icons/calendar.svg" style="width: 20px; margin-right: 4px;"><a
                        href="historicoAlertas.html">Histórico de Alertas</a></li>
                <li style="display: flex; align-items: center;" data-role="Administrador"><img
                        src="./assets/dashboard-icons/users.svg" style="width: 20px; margin-right: 4px;"><a
                        href="cadastroFuncionarios.html">Cadastro Funcionário</a></li>
                <li style="display: flex; align-items: center;" data-role="Técnico,Administrador"><img
                        src="./assets/dashboard-icons/hard-drive.svg" style="width: 20px; margin-right: 4px;"><a
                        href="cadastroServidores.html">Cadastro Servidores</a></li>
                <li style="display: flex; align-items: center;" data-role="Analista,Técnico,Administrador"><img
                        src="./assets/dashboard-icons/help-circle.svg" style="width: 20px; margin-right: 4px;"><a
                        href="https://vitalviewsptech.atlassian.net/servicedesk/customer/portal/1"
                        target="_blank">Central de Serviço</a></li>
                <li style="display: flex; align-items: center;" data-role="Analista,Técnico,Administrador"><img
                        src="./assets/dashboard-icons/log-out.svg" style="width: 20px; margin-right: 4px;"><a
                        onclick="limparSessao()">Sair</a></li>
            </div>
        </ul>
    </nav>

    <section class="container">
        <section class="nav-dash">
            <section class="secao_logo">
                <a href="dashboardAnalista.html">
                    <img src="assets/LogoVitalView.png" alt="Logo VitalView" class="logo">
                </a>
            </section>

            <section class="secao_logo">
                <h1 class="titulo_header" style="margin-left: 10px;">VitalView</h1>
            </section>
        </section>

        <main class="grid">
            <div class="parteCima">

                <section class="card kpi pacotes">
                    <h3>Perda de Pacotes</h3>
                    <div class="caption">Percentual (%)</div>
                    <div class="kpi-number" id="loss-pct">--%</div>
                    <div class="badge" id="loss-status">--</div>
                </section>

                <section class="card kpi conexoes">
                    <h3>Conexões</h3>
                    <div class="caption">Conexões ativas</div>
                    <div class="kpi-number" id="conexoes-ativas">39</div>
                    <div class="badge" id="conexoes-status">Normal</div>
                </section>

                <section class="card latencia">
                    <h3>Latência</h3>
                    <div class="caption">Tempo de resposta (ms)</div>
                    <div class="kpi-number" id="latencia-atual">--</div>
                    <div class="badge" id="latencia-status">--</div>
                </section>

            </div>

            <div class="parteBaixo">
                <section class="card trafego">
                    <h3>Velocidade de Tráfego de Rede</h3>
                    <div class="caption">(Megabits por segundo)</div>

                    <div class="row">
                        <div class="kpi">
                            <strong>Download</strong>
                        </div>
                        <div class="bar-wrap" aria-label="barra download">
                            <div class="bar" id="bar-down"></div>
                        </div>
                        <div class="value"> <span id="val-down">87</span> Mbps</div>
                        <div class="badge" style="position:static; transform:none; margin-left:8px" id="down-status">
                            Normal
                        </div>
                    </div>

                    <div class="row">
                        <div class="kpi">
                            <strong>Upload</strong>
                        </div>
                        <div class="bar-wrap" aria-label="barra upload">
                            <div class="bar alerta" id="bar-up"></div>
                        </div>
                        <div class="value"> <span id="val-up">18</span> Mbps</div>
                        <div class="badge alerta" style="position:static; transform:none; margin-left:8px"
                            id="up-status">
                            Alerta
                        </div>
                    </div>
                </section>

                <section class="card entrada">
                    <h3>Pacotes Enviados e Recebidos</h3>
                    <div class="caption">(Quantidade de pacotes IN/OUT)</div>
                    <div class="chart-box">
                        <canvas id="ioChart"></canvas>
                    </div>
                    <div class="badge">Normal</div>
                </section>
            </div>
        </main>

    </section>

    <script src="js/permissoes.js"></script>

    <script>

        function setBadge(el, status, numberEl) {

            el.classList.remove('ok', 'alerta');
            if (status === 'Alerta') el.classList.add('alerta');
            if (status === 'Normal') el.classList.add('ok');
            el.textContent = status;


            if (numberEl) {
                numberEl.classList.remove('ok', 'alerta');
                if (status === 'Alerta') numberEl.classList.add('alerta');
                if (status === 'Normal') numberEl.classList.add('ok');
            }
        }


        if (typeof protegerPagina === 'function') {
            protegerPagina(['Técnico', 'Administrador']);
        }
        if (typeof aplicarCargoNaUI === 'function') {
            aplicarCargoNaUI();
        }

        const teal = '#14b8a6';
        const teal2 = '#0ea5e9';

        // estado mocado dos meus dados
        const METRICAS = {
            pacotesPerdidos: 8,
            conexoesAtivas: 39,
            banda: { capacidade: 300, usada: 78 },
            ping: {
                rttMsAtual: 23,
                enviados: 10,
                perdidos: 1
            }
        };

        // KPI: Latência 
        const latNow = document.getElementById('latencia-atual');
        const latBadge = document.getElementById('latencia-status');
        if (latNow && latBadge) {
            latNow.textContent = METRICAS.ping.rttMsAtual + ' ms';
            if (METRICAS.ping.rttMsAtual <= 80) setBadge(latBadge, 'Normal', latNow);
            else setBadge(latBadge, 'Alerta', latNow);
        }

        // KPI: Perda de Pacotes (%)
        const lossPctEl = document.getElementById('loss-pct');
        const lossBadge = document.getElementById('loss-status');
        if (lossPctEl && lossBadge) {
            const perdaPct = METRICAS.ping.enviados > 0
                ? (METRICAS.ping.perdidos / METRICAS.ping.enviados) * 100
                : 0;
            lossPctEl.textContent = perdaPct.toFixed(1) + '%';
            if (perdaPct < 5) setBadge(lossBadge, 'Normal', lossPctEl);
            else setBadge(lossBadge, 'Alerta', lossPctEl);
        }

        // KPI: Conexões
        const conVal = document.getElementById('conexoes-ativas');
        const conBadge = document.getElementById('conexoes-status');
        if (conVal && conBadge) {
            conVal.textContent = METRICAS.conexoesAtivas;
            const ok = METRICAS.conexoesAtivas >= 10 && METRICAS.conexoesAtivas <= 200;
            setBadge(conBadge, ok ? 'Normal' : 'Alerta', conVal);
        }

        // Barras de download/upload 
        function setBar(el, value, max) {
            const pct = Math.max(0, Math.min(100, (value / max) * 100));
            el.style.width = pct + '%';
        }
        const barDown = document.getElementById('bar-down');
        const barUp = document.getElementById('bar-up');
        if (barDown && barUp) {
            setBar(barDown, 87, 100);
            setBar(barUp, 18, 100);
        }
        const up = 18, down = 87;
        const upBadge = document.getElementById('up-status');
        const downBadge = document.getElementById('down-status');
        if (upBadge) { if (up > 80) { upBadge.classList.add('alerta'); upBadge.textContent = 'Alerta'; } }
        if (downBadge) { if (down <= 50) { downBadge.textContent = 'Normal'; } }

        // Linha IN/OUT 
        const ioCanvas = document.getElementById('ioChart');
        if (ioCanvas && window.Chart) {
            const ioLabels = ['07:45', '10:50', '13:55', '18:00', '19:05'];
            const entrada = [40, 80, 10, 25, 40];
            const saida = [10, 30, 5, 12, 30];

            new Chart(ioCanvas, {
                type: 'line',
                data: {
                    labels: ioLabels,
                    datasets: [
                        { label: 'Entrada', data: entrada, borderColor: teal2, backgroundColor: teal2, tension: .35, pointRadius: 3, fill: false },
                        { label: 'Saída', data: saida, borderColor: teal, backgroundColor: teal, tension: .35, pointRadius: 3, fill: false }
                    ]
                },
                options: {
                    maintainAspectRatio: false,
                    scales: { x: { grid: { display: false } }, y: { beginAtZero: true, grid: { color: '#eef2f7' } } },
                    plugins: { legend: { position: 'top' } }
                }
            });
        }
    </script>
</body>

</html>